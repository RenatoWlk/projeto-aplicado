<div class="container">
  <h1>Minha Conta</h1>

  <ng-container *ngIf="!editProfileMode && !changePasswordMode && !showAchievements">
    <div class="account-header">
      <div class="profile-photo-wrapper">
        <img [src]="user?.photoUrl || 'assets/profile2.png'" alt="Foto de Perfil" class="profile-photo" />
        <input #fileInput type="file" (change)="onPhotoSelected($event)" accept="image/*" hidden>
        <button type="button" class="profile-photo-edit-btn" (click)="fileInput.click()">
          Trocar Foto
        </button>
      </div>
      <div class="account-info">
        <p><strong>Nome:</strong> {{ user?.name }}</p>
        <p><strong>Email:</strong> {{ user?.email }}</p>
        <p><strong>Tipo Sanguíneo:</strong> {{ user?.bloodType }}</p>
        <button type="button" (click)="onEditProfile()" [disabled]="changePasswordMode">Editar Perfil</button>
        <button type="button" (click)="onChangePassword()" [disabled]="editProfileMode">Alterar Senha</button>
        <button type="button" (click)="showAchievements = true" [disabled]="editProfileMode || changePasswordMode">
          Ver Conquistas
        </button>
      </div>
    </div>

    <hr />

    <div class="account-details">
      <p><strong>Última doação:</strong> {{ user?.lastDonation | date:'dd/MM/yyyy' }}</p>
      <p><strong>Próxima doação possível:</strong> {{ user?.nextEligibleDonation | date:'dd/MM/yyyy' }}</p>
    </div>

    <div class="last-questionnaire" *ngIf="lastQuestionnaire">
      <h2>Último Questionário de Doação</h2>
      <p><strong>Data:</strong> {{ lastQuestionnaire.date | date:'dd/MM/yyyy' }}</p>
      <ul>
        <li *ngFor="let item of lastQuestionnaire.answers">
          <strong>{{ item?.question }}</strong> <br>
          Resposta: {{ item?.answer }}
        </li>
      </ul>
    </div>
  </ng-container>

  <form *ngIf="editProfileMode && !changePasswordMode && editUser">
    <label>
      Nome:
      <input type="text" [(ngModel)]="editUser.name" name="name" />
    </label>
    <label>
      Email:
      <input type="email" [(ngModel)]="editUser.email" name="email" />
    </label>
    <label>
      <button type="button" (click)="saveProfile()">Salvar</button>
      <button type="button" (click)="cancelEdit()">Cancelar</button>
    </label>
  </form>

  <form *ngIf="changePasswordMode && !editProfileMode">
    <label>
      Nova senha:
      <input type="password" [(ngModel)]="newPassword" name="password" />
    </label>
    <label>
      <button type="button" (click)="savePassword()">Salvar Senha</button>
      <button type="button" (click)="cancelPassword()">Cancelar</button>
    </label>
  </form>

  <div *ngIf="showAchievements" class="achievements-page">
    <h2>Minhas Conquistas</h2>
    <div class="badges-list">
      <div class="badge" *ngFor="let badge of user?.achievements">
        <img [src]="badge.iconUrl" [alt]="badge.title" />
        <span class="badge-title">{{ badge.title }}</span>
        <span class="badge-desc">{{ badge.description }}</span>
      </div>
    </div>
    <button type="button" (click)="showAchievements = false">Voltar</button>
  </div>
</div>